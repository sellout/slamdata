language: node_js
node_js:
  - 0.10
env:
  - TAG=v0.6.9.3
install:
  - wget -O $HOME/purescript.tar.gz https://github.com/purescript/purescript/releases/download/$TAG/linux64.tar.gz
  - sudo tar zxvf $HOME/purescript.tar.gz -C /usr/local/bin purescript/psc{,i,-docs,-make} --strip-components=1
  - sudo chmod a+x /usr/local/bin/psc{,i,-docs,-make}
  - npm install bower gulp -g
  - npm install && bower install --force
script:
  - gulp deploy-prod
before_deploy:
  - cp -r public slamdata
  - tar cjf slamdata.tar.bz2 slamdata
deploy:
  provider: releases
  api_key: "SYixjxUW+coVNeK7k39DQLeddp4TxN0jzmjbYtXYo8X11uGJsWk6gXj4UP3w8uHgpdAt61OMDen+ixH47Y8O2mDISZiImyVDvsJqQzl2INqErl8Q9CqhCn2NdZvS7hZ/Qn9sHfL8SSXJdjiURTUt27nYigscHTFwH5AVaZPdkDQ="
  file: "slamdata.tar.bz2"
  skip_cleanup: true
  on:
  #   repo: slamdata/slamdata
    branch: wip/publish-release
notifications:
  irc:
    channels:
      - "chat.freenode.net#slamdata"
    template:
      - "%{result}: %{repository_slug}#%{build_number} (%{branch}@%{commit}: %{author}) %{build_url}"
